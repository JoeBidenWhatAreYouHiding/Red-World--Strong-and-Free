get_current_government_type = {
	clear_variable = original_government_type
	set_variable = { original_government_type = current_party_ideology_group }

	clear_array = original_popularities
	add_to_array = { original_popularities = party_popularity_100@national_bolshevik }
	add_to_array = { original_popularities = party_popularity_100@communist }
	add_to_array = { original_popularities = party_popularity_100@revolutionary_socialist }
	add_to_array = { original_popularities = party_popularity_100@new_democrat }
	add_to_array = { original_popularities = party_popularity_100@liberal }
	add_to_array = { original_popularities = party_popularity_100@centrist }
	add_to_array = { original_popularities = party_popularity_100@national_conservative }
	add_to_array = { original_popularities = party_popularity_100@nationalist }
	add_to_array = { original_popularities = party_popularity_100@fascist }
	#add_to_array = { original_popularities = party_popularity_100@monarchist }

	set_temp_variable = { sum = 100 }
	for_each_loop = {
		array = original_popularities
		subtract_from_temp_variable = { sum = v }
	}
	add_to_array = { original_popularities = sum } #last value (natpop), calculated directly to avoid rounding errors
}

restore_previous_government_type = {
	hidden_effect = {
		if = {
			limit = { has_variable = original_government_type } #needed to avoid a CTD
			set_politics = {
				ruling_party = var:original_government_type
			}
		}
		clear_variable = original_government_type

		if = {
			limit = { check_variable = { original_popularities^num > 0 } }
			set_popularities = {
				national_bolshevik = original_popularities^0
				communist = original_popularities^1
				revolutionary_socialist = original_popularities^2
				new_democrat = original_popularities^3
				liberal = original_popularities^4
				centrist = original_popularities^5
				national_conservative = original_popularities^6
				nationalist = original_popularities^7
				fascist = original_popularities^8
				monarchist = original_popularities^9
			}
			clear_array = original_popularities
		}
	}
}

CAN_subtract_5_percent_popularity = {
	if = {
		limit = {
			has_government = fascist
		}
		add_popularity = {
			ideology = fascist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = nationalist
		}
		add_popularity = {
			ideology = nationalist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_conservative
		}
		add_popularity = {
			ideology = national_conservative
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = centrist
		}
		add_popularity = {
			ideology = centrist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = liberal
		}
		add_popularity = {
			ideology = liberal
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = new_democrat
		}
		add_popularity = {
			ideology = new_democrat
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = moderate_socialist
		}
		add_popularity = {
			ideology = moderate_socialist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = revolutionary_socialist
		}
		add_popularity = {
			ideology = revolutionary_socialist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = communist
		}
		add_popularity = {
			ideology = communist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_bolshevik
		}
		add_popularity = {
			ideology = national_bolshevik
			popularity = -0.05
		}
	}
}

CAN_add_5_percent_popularity = {
	if = {
		limit = {
			has_government = fascist
		}
		add_popularity = {
			ideology = fascist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = nationalist
		}
		add_popularity = {
			ideology = nationalist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_conservative
		}
		add_popularity = {
			ideology = national_conservative
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = centrist
		}
		add_popularity = {
			ideology = centrist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = liberal
		}
		add_popularity = {
			ideology = liberal
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = new_democrat
		}
		add_popularity = {
			ideology = new_democrat
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = moderate_socialist
		}
		add_popularity = {
			ideology = moderate_socialist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = revolutionary_socialist
		}
		add_popularity = {
			ideology = revolutionary_socialist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = communist
		}
		add_popularity = {
			ideology = communist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_bolshevik
		}
		add_popularity = {
			ideology = national_bolshevik
			popularity = 0.05
		}
	}
}

CAN_add_3_percent_popularity = {
	if = {
		limit = {
			has_government = fascist
		}
		add_popularity = {
			ideology = fascist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = nationalist
		}
		add_popularity = {
			ideology = nationalist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = national_conservative
		}
		add_popularity = {
			ideology = national_conservative
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = centrist
		}
		add_popularity = {
			ideology = centrist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = liberal
		}
		add_popularity = {
			ideology = liberal
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = new_democrat
		}
		add_popularity = {
			ideology = new_democrat
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = moderate_socialist
		}
		add_popularity = {
			ideology = moderate_socialist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = revolutionary_socialist
		}
		add_popularity = {
			ideology = revolutionary_socialist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = communist
		}
		add_popularity = {
			ideology = communist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = national_bolshevik
		}
		add_popularity = {
			ideology = national_bolshevik
			popularity = 0.03
		}
	}
}