get_current_government_type = {
	clear_variable = original_government_type
	set_variable = { original_government_type = current_party_ideology_group }

	clear_array = original_popularities
	add_to_array = { original_popularities = party_popularity_100@national_bolshevik }
	add_to_array = { original_popularities = party_popularity_100@communist }
	add_to_array = { original_popularities = party_popularity_100@revolutionary_socialist }
	add_to_array = { original_popularities = party_popularity_100@new_democrat }
	add_to_array = { original_popularities = party_popularity_100@liberal }
	add_to_array = { original_popularities = party_popularity_100@centrist }
	add_to_array = { original_popularities = party_popularity_100@national_conservative }
	add_to_array = { original_popularities = party_popularity_100@nationalist }
	add_to_array = { original_popularities = party_popularity_100@fascist }
	#add_to_array = { original_popularities = party_popularity_100@monarchist }

	set_temp_variable = { sum = 100 }
	for_each_loop = {
		array = original_popularities
		subtract_from_temp_variable = { sum = v }
	}
	add_to_array = { original_popularities = sum } #last value (natpop), calculated directly to avoid rounding errors
}

restore_previous_government_type = {
	hidden_effect = {
		if = {
			limit = { has_variable = original_government_type } #needed to avoid a CTD
			set_politics = {
				ruling_party = var:original_government_type
			}
		}
		clear_variable = original_government_type

		if = {
			limit = { check_variable = { original_popularities^num > 0 } }
			set_popularities = {
				national_bolshevik = original_popularities^0
				communist = original_popularities^1
				revolutionary_socialist = original_popularities^2
				new_democrat = original_popularities^3
				liberal = original_popularities^4
				centrist = original_popularities^5
				national_conservative = original_popularities^6
				nationalist = original_popularities^7
				fascist = original_popularities^8
				monarchist = original_popularities^9
			}
			clear_array = original_popularities
		}
	}
}

CAN_subtract_5_percent_popularity = {
	if = {
		limit = {
			has_government = fascist
		}
		add_popularity = {
			ideology = fascist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = nationalist
		}
		add_popularity = {
			ideology = nationalist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_conservative
		}
		add_popularity = {
			ideology = national_conservative
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = centrist
		}
		add_popularity = {
			ideology = centrist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = liberal
		}
		add_popularity = {
			ideology = liberal
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = new_democrat
		}
		add_popularity = {
			ideology = new_democrat
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = moderate_socialist
		}
		add_popularity = {
			ideology = moderate_socialist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = revolutionary_socialist
		}
		add_popularity = {
			ideology = revolutionary_socialist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = communist
		}
		add_popularity = {
			ideology = communist
			popularity = -0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_bolshevik
		}
		add_popularity = {
			ideology = national_bolshevik
			popularity = -0.05
		}
	}
}

CAN_add_5_percent_popularity = {
	if = {
		limit = {
			has_government = fascist
		}
		add_popularity = {
			ideology = fascist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = nationalist
		}
		add_popularity = {
			ideology = nationalist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_conservative
		}
		add_popularity = {
			ideology = national_conservative
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = centrist
		}
		add_popularity = {
			ideology = centrist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = liberal
		}
		add_popularity = {
			ideology = liberal
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = new_democrat
		}
		add_popularity = {
			ideology = new_democrat
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = moderate_socialist
		}
		add_popularity = {
			ideology = moderate_socialist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = revolutionary_socialist
		}
		add_popularity = {
			ideology = revolutionary_socialist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = communist
		}
		add_popularity = {
			ideology = communist
			popularity = 0.05
		}
	}
	else_if = {
		limit = {
			has_government = national_bolshevik
		}
		add_popularity = {
			ideology = national_bolshevik
			popularity = 0.05
		}
	}
}

CAN_add_3_percent_popularity = {
	if = {
		limit = {
			has_government = fascist
		}
		add_popularity = {
			ideology = fascist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = nationalist
		}
		add_popularity = {
			ideology = nationalist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = national_conservative
		}
		add_popularity = {
			ideology = national_conservative
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = centrist
		}
		add_popularity = {
			ideology = centrist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = liberal
		}
		add_popularity = {
			ideology = liberal
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = new_democrat
		}
		add_popularity = {
			ideology = new_democrat
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = moderate_socialist
		}
		add_popularity = {
			ideology = moderate_socialist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = revolutionary_socialist
		}
		add_popularity = {
			ideology = revolutionary_socialist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = communist
		}
		add_popularity = {
			ideology = communist
			popularity = 0.03
		}
	}
	else_if = {
		limit = {
			has_government = national_bolshevik
		}
		add_popularity = {
			ideology = national_bolshevik
			popularity = 0.03
		}
	}
}

CAN_remove_first_term_spirits = {
	hidden_effect = {
		# Trump #
		remove_ideas = CAN_business_as_usual
		remove_ideas = CAN_antiestablishmentarianism
		remove_ideas = CAN_establishment_cabinet
		remove_ideas = CAN_antiestablishmentarianism2
		remove_ideas = CAN_ruling_from_the_centre
		remove_ideas = CAN_unabashed_conservatism
		remove_ideas = CAN_ford_machine
		remove_ideas = CAN_making_canada_proud
		remove_ideas = CAN_making_canada_free
		remove_ideas = CAN_making_canada_strong
		# Harper #
		remove_ideas = CAN_pcs_strengthened
		remove_ideas = CAN_pcs_strengthened2_reform
		remove_ideas = CAN_strong_and_free
		remove_ideas = CAN_pcs_strengthened2_pc
		remove_ideas = CAN_the_true_north
		remove_ideas = CAN_fiscal_and_social_conservatism
		remove_ideas = CAN_neoconservatism
		remove_ideas = CAN_diefenbakerism
		# Layton #
		remove_ideas = CAN_centrist_ndp
		remove_ideas = CAN_liberal_confidence
		remove_ideas = CAN_the_new_ginger_group
		remove_ideas = CAN_the_new_waffle
		remove_ideas = CAN_unabashed_progressivism
		# Rae #
		remove_ideas = CAN_liberal_coalition
		remove_ideas = CAN_liberal_coalition2
		remove_ideas = CAN_ndp_roots
		remove_ideas = CAN_layton_support
		remove_ideas = CAN_layton_liberal_support
		remove_ideas = CAN_canadian_red_scare
		# Trudeau #
		remove_ideas = CAN_trudeau_antiestablishment
		remove_ideas = CAN_trudeau_establishment
		# Ignatieff #
		remove_ideas = CAN_looking_to_the_right
		remove_ideas = CAN_looking_to_the_right2
		remove_ideas = CAN_looking_to_the_right3
		remove_ideas = CAN_philosophical_liberalism_right
		remove_ideas = CAN_repairing_chretiens_legacy
		remove_ideas = CAN_repairing_chretiens_legacy2
		remove_ideas = CAN_repairing_chretiens_legacy3
		remove_ideas = CAN_philosophical_liberalism_left
		remove_ideas = CAN_liberal_support_surge
	}
}

CAN_create_alberta = {
	hidden_effect = {
		create_dynamic_country = {	#Alberta
			original_tag = CAN
			copy_tag = CAN
			
			transfer_state = 470
			add_state_core = 470
				
			save_global_event_target_as = alberta_target

			### Politics
			set_popularities = {
				fascist = 0
				nationalist = 40
				monarchist = 0
				national_bolshevik = 0
				national_conservative = 30
				centrist = 5
				liberal = 5
				new_democrat = 20
				moderate_socialist = 0
				revolutionary_socialist = 0
				communist = 0
			}
			
			set_politics = {
				ruling_party = nationalist
				elections_allowed = no
			}
			
			### Parties
			
			set_party_name = {
				ideology = fascist
				name = "Independence Party"
				long_name = "Independence Party of Alberta"
			}
			set_party_name = {
				ideology = national_bolshevik
				name = "ANDP (R)"
				long_name = "Alberta New Democratic Party (Radicals)"
			}
			set_party_name = {
				ideology = nationalist
				name = "Wildrose"
				long_name = "Wildrose Party of Alberta"
			}
			set_party_name = {
				ideology = liberal
				name = "Liberals"
				long_name = "Liberal Party of Alberta"
			}
			set_party_name = {
				ideology = centrist
				long_name = "Alberta Party"
				name = "Alberta Party"
			}
			set_party_name = {
				ideology = national_conservative
				name = "PCs"
				long_name = "Progressive Conservative Party of Alberta"
			}
			set_party_name = {
				ideology = new_democrat
				name = "ANDP"
				long_name = "Alberta New Democratic Party"
			}
			
			### Leaders
			
			recruit_character = ALT_artur_pawlowski
			recruit_character = ALT_jordan_peterson
			recruit_character = ALT_donald_ethell
			recruit_character = ALT_alison_redford
			recruit_character = ALT_danielle_smith
			recruit_character = ALT_greg_clark
			recruit_character = ALT_david_swann
			recruit_character = ALT_rachel_notley
			
			ALT_artur_pawlowski = {
				promote_character = clerical_fascist
			}
			ALT_jordan_peterson = {
				promote_character = socialist_nationalist
			}
			ALT_donald_ethell = {
				promote_character = regency_monarchist
			}
			ALT_alison_redford = {
				promote_character = progressive_conservative
			}
			ALT_danielle_smith = {
				promote_character = neoconservative
			}
			ALT_greg_clark = {
				promote_character = centrist_ideology
			}
			ALT_david_swann = {
				promote_character = social_liberal
			}
			ALT_rachel_notley = {
				promote_character = labour_revisionist
			}
			
			### Cosmetic
			
			set_cosmetic_tag = ALT
		}
		
		event_target:alberta_target = { 
			get_current_government_type = yes
		}
		CAN = {
			puppet = event_target:alberta_target
		}
		event_target:alberta_target = { 
			restore_previous_government_type = yes
		}
	}
	
}